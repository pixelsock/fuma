"use strict";exports.id=399,exports.ids=[399],exports.modules={55399:(e,t,r)=>{r.d(t,{a$:()=>D,l6:()=>f,GE:()=>g,bW:()=>h});var s=r(42929);function n(e){return!!e&&["publish","published","draft"].includes(e.toLowerCase())}function i(){let e=process.env.DEPLOYMENT_ENV?.toLowerCase();return"local"===e||"production"===e?e:"production"}function o(){let e=i();if(console.log(`[env-config] Deployment environment: ${e}`),console.log("[env-config] NODE_ENV: production"),console.log(`[env-config] DEPLOYMENT_ENV: ${process.env.DEPLOYMENT_ENV}`),"local"===e){let e={url:process.env.LOCAL_DIRECTUS_URL||"http://localhost:8056",token:process.env.LOCAL_DIRECTUS_TOKEN,email:process.env.LOCAL_DIRECTUS_EMAIL,password:process.env.LOCAL_DIRECTUS_PASSWORD};return console.log(`[env-config] Using LOCAL configuration: ${e.url}`),e}{let e={url:process.env.PRODUCTION_DIRECTUS_URL||"https://admin.charlotteudo.org",token:process.env.PRODUCTION_DIRECTUS_TOKEN,email:process.env.PRODUCTION_DIRECTUS_EMAIL,password:process.env.PRODUCTION_DIRECTUS_PASSWORD};return console.log(`[env-config] Using PRODUCTION configuration: ${e.url}`),e}}let l=o(),c=l.url,u=l.token;console.log("[lib/directus-client.ts] Environment Status:",function(){let e=i(),t=o();return{deploymentEnvironment:e,nodeEnv:"production",explicitEnv:process.env.DEPLOYMENT_ENV,directusUrl:t.url,hasToken:!!t.token,hasCredentials:!!(t.email&&t.password),isLocal:"local"===e,isProduction:"production"===e}}()),console.log("[lib/directus-client.ts] Directus URL:",c),console.log("[lib/directus-client.ts] Token configured:",u?`${u.substring(0,10)}...`:"not set"),console.log("[lib/directus-client.ts] Environment type:","server");let a=(0,s.ieq)(c).with((0,s.zs8)()).with(u?(0,s.iyv)(u):(0,s.jhO)());async function d(){if(console.log("[directus-client.ts] ensureAuthenticated called"),u)return console.log("[directus-client.ts] Using static token authentication"),!0;let{email:e,password:t}=function(){let e=o();return{email:e.email,password:e.password}}();if(console.log("[directus-client.ts] Email configured:",!!e),console.log("[directus-client.ts] Password configured:",!!t),!e||!t)return console.warn("[directus-client.ts] Directus credentials not configured. Skipping Directus content."),!1;try{return console.log("[directus-client.ts] Attempting to authenticate with Directus..."),await a.login({email:e,password:t}),console.log("[directus-client.ts] Successfully authenticated with Directus"),!0}catch(e){return console.error("[directus-client.ts] Failed to authenticate with Directus:",e),!1}}async function g(){try{if(console.log("[directus-source.ts] getArticles called"),!await d())return console.log("[directus-source.ts] Not authenticated, returning empty array"),[];let e=await h(),t=new Map;e.forEach(e=>{t.set(e.id,e)}),console.log("[directus-source.ts] Making request to Directus API..."),console.log("[directus-source.ts] Directus client URL:",a.url);let r=await a.request((0,s.F1f)("articles",{filter:{slug:{_nnull:!0,_nempty:!0},status:{_in:["publish","published"]}},fields:["id","name","slug","status","content","category","PDF"],sort:["name"]}));return console.log(`[directus-source.ts] Successfully fetched ${r.length} articles from Directus`),await Promise.all(r.filter(e=>e.slug&&""!==e.slug?n(e.status):(console.warn(`Warning: Skipping article ID ${e.id||"unknown"} - missing required field: slug`),!1)).map(e=>m(e,t)))}catch(e){return console.error("Error fetching articles from Directus:",e),[]}}async function f(e){try{let t;if(!await d())return null;if(!e||""===e){console.log("Getting first article for homepage");let e=await a.request((0,s.F1f)("articles",{filter:{slug:{_nnull:!0,_nempty:!0},status:{_in:["publish","published"]},content:{_nnull:!0,_nempty:!0}},fields:["id","name","slug","status","content"],limit:1,sort:["name"]}));if(console.log(`Homepage query found ${e.length} articles with content`),e.length>0){let t=e[0];return console.log(`Using article as homepage: '${t.name}' (${t.slug})`),await m(t)}return console.log("No articles with content found in Directus for homepage"),null}let r=function(e){if(!e.includes("/"))return e;let t=e.split("/"),r=t[t.length-1];return r.startsWith("article-")?r:e}(e);if(r===e&&e.includes("/")){let t=e.split("/");r=t[t.length-1]}console.log(`[directus-source.ts] Resolving slug: '${e}' â†’ '${r}'`),console.log("[directus-source.ts] Making article request with client URL:",a.url);try{let e={filter:{slug:{_eq:r,_nnull:!0,_nempty:!0},status:{_in:["publish","published"]}},fields:["id","name","slug","status","content","PDF"],limit:1};console.log("[directus-source.ts] Trying query with PDF field:",JSON.stringify(e,null,2)),t=(await a.request((0,s.F1f)("articles",e)))[0],console.log("[directus-source.ts] Successfully got article with PDF field")}catch(n){console.log("[directus-source.ts] PDF field not accessible, falling back to basic query:",n.message);let e={filter:{slug:{_eq:r,_nnull:!0,_nempty:!0},status:{_in:["publish","published"]}},fields:["id","name","slug","status","content"],limit:1};if(console.log("[directus-source.ts] Query parameters (fallback):",JSON.stringify(e,null,2)),t=(await a.request((0,s.F1f)("articles",e)))[0]){let e=await p(r);e&&(t.pdf=e,console.log("[directus-source.ts] Found PDF via naming convention:",e))}}if(!t)return console.log(`Article with slug '${r}' (from '${e}') not found in Directus`),null;if(!n(t.status))return console.log(`Article '${r}' found but not published (status: ${t.status})`),null;return console.log(`Successfully fetched article '${r}' from Directus`),await m(t)}catch(t){return console.error(`Error fetching article '${e}' from Directus:`,t),t.errors&&console.error("Directus API errors:",JSON.stringify(t.errors,null,2)),t.response&&(console.error("Response status:",t.response.status),console.error("Response data:",t.response.data)),null}}async function p(e){try{let t=o().url,r=`${t}/assets/pdfs/${e}.pdf`;if((await fetch(r,{method:"HEAD",headers:{Authorization:"Bearer H8AAfXMOVHZc7Bicu1JVsaNdF0ZXIYoM"}})).ok)return`pdfs/${e}.pdf`;return null}catch(t){return console.log(`No PDF found for ${e}:`,t),null}}async function m(e,t){try{let r,s,n=e.name??e.title??"Untitled",i=e.content||"";if(e.PDF?"string"==typeof e.PDF?r=e.PDF:e.PDF&&"object"==typeof e.PDF&&"id"in e.PDF&&(r=e.PDF.id):e.pdf&&(r=e.pdf),e.category&&"object"==typeof e.category&&"key"in e.category){let r=e.category.key;if(t&&t.has(r))s=t.get(r);else try{s=(await h()).find(e=>e.id===r)}catch(e){console.error("Error fetching category:",e)}}return{id:e.id||"",name:n,title:n,description:"",htmlContent:i,slug:e.slug||"",status:e.status||"draft",pdf:r,category:s}}catch(r){console.error(`Error processing article ID ${e.id||"unknown"}:`,r);let t=e.name??e.title??"Untitled";return{id:e.id||"",name:t,title:t,description:"",htmlContent:"<p><em>Content processing failed</em></p>",slug:e.slug||"",status:e.status||"draft"}}}async function h(){try{if(!await d())return[];let e=await a.request((0,s.F1f)("article_categories",{fields:["id","name","slug","description","order","color"],sort:["order","name"]}));return console.log(`Successfully fetched ${e.length} categories from Directus`),e.map(e=>({id:e.id,name:e.name,slug:e.slug,description:e.description,order:e.order,color:e.color}))}catch(e){return console.error("Error fetching categories from Directus:",e),[]}}async function D(){try{if(!await d())return[];let e=(await a.request((0,s.F1f)("articles",{filter:{slug:{_nnull:!0,_nempty:!0},status:{_in:["publish","published"]}},fields:["id","slug","status"]}))).filter(e=>!!e.slug&&""!==e.slug||(console.warn(`Warning: Skipping article ID ${e.id||"unknown"} in param generation - missing required field: slug`),!1)).map(e=>({slug:(function(e){let t=e.match(/^article-(\d+)/);if(!t)return e;let r=parseInt(t[1],10);if(r>=1&&r<=2)return`part-i-ordinance-introduction/${e}`;if(3===r)return`part-ii-zoning-introduction/${e}`;if(r>=4&&r<=5)return`part-iii-neighborhood-zoning-districts/${e}`;if(r>=6&&r<=9)return`part-iv-employment-zoning-districts/${e}`;if(r>=10&&r<=13)return`part-v-centers-zoning-districts/${e}`;else if(14===r)return`part-vi-special-purpose-overlay-zoning-districts/${e}`;else if(15===r)return`part-vii-uses/${e}`;else if(r>=16&&r<=22)return`part-viii-general-development-zoning-standards/${e}`;else if(r>=23&&r<=28)return`part-ix-stormwater/${e}`;else if(r>=29&&r<=34)return`part-x-subdivision-streets-other-infrastructure/${e}`;else if(r>=35&&r<=37)return`part-xi-administration/${e}`;else if(38===r)return`part-xii-nonconformities/${e}`;else if(39===r)return`part-xiii-enforcement/${e}`;return e})(e.slug).split("/").filter(Boolean)}));return console.log(`Generated ${e.length} static params from Directus articles`),console.log("Sample params:",e.slice(0,3)),e}catch(e){return console.error("Error generating article params from Directus:",e),[]}}}};