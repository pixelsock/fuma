"use strict";exports.id=929,exports.ids=[929],exports.modules={42929:(e,t,s)=>{s.d(t,{F1f:()=>b,ieq:()=>d,iyv:()=>h,jhO:()=>f,zs8:()=>j});var r=(e,t)=>(e.endsWith("/")&&(e=e.slice(0,-1)),t.startsWith("/")||(t="/"+t),e+t),i=(e,t,s)=>{let i=new globalThis.URL("/"===e.pathname?t:r(e.pathname,t),e);if(s)for(let[e,t]of Object.entries(g(s)))if(t&&"object"==typeof t&&!Array.isArray(t))for(let[s,r]of Object.entries(t))i.searchParams.set(`${e}[${s}]`,String(r));else i.searchParams.set(e,t);return i};async function n(e){if(!("object"!=typeof e||!e)){if("object"==typeof e&&e&&"headers"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json&&"text"in e&&"function"==typeof e.json){let t=e.headers.get("Content-Type")?.toLowerCase();if(t?.startsWith("application/json")||t?.startsWith("application/health+json")){let t=await e.json();if(!e.ok||"errors"in t)throw t;return"data"in t?t.data:t}if(t?.startsWith("text/html")||t?.startsWith("text/plain")){let t=await e.text();if(!e.ok)throw t;return t}return 204===e.status?null:e}if("errors"in e)throw e;return"data"in e?e.data:e}}var o=async(e,t,s=globalThis.fetch)=>(t.headers="object"!=typeof t.headers||Array.isArray(t.headers)?{}:t.headers,s(e,t).then(e=>n(e).catch(t=>{let s={errors:t&&"object"==typeof t&&"errors"in t?t.errors:t,response:e};return t&&"object"==typeof t&&"data"in t&&(s.data=t.data),Promise.reject(s)}))),a=()=>{let e=null;return{get:async()=>e,set:async t=>{e=t}}},l={msRefreshBeforeExpires:3e4,autoRefresh:!0},c=0x80000000-1,f=(e="cookie",t={})=>s=>{let r={...l,...t},n=null,f=null,h=r.storage??a(),u=async()=>h.set({access_token:null,refresh_token:null,expires:null,expires_at:null}),d=async()=>{try{await n}finally{n=null}},p=async()=>{let e=await h.get();return n||!e?.expires_at||e.expires_at<new Date().getTime()+r.msRefreshBeforeExpires&&y().catch(e=>{}),d()},g=async e=>{let t=e.expires??0;e.expires_at=new Date().getTime()+t,await h.set(e),r.autoRefresh&&t>r.msRefreshBeforeExpires&&t<c&&(f&&clearTimeout(f),f=setTimeout(()=>{f=null,y().catch(e=>{})},t-r.msRefreshBeforeExpires))},y=async(t={})=>n=(async()=>{let n=await h.get();await u();let a={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in r&&(a.credentials=r.credentials);let l={mode:t.mode??e};return"json"===e&&n?.refresh_token&&(l.refresh_token=n.refresh_token),a.body=JSON.stringify(l),o(i(s.url,"/auth/refresh").toString(),a,s.globals.fetch).then(e=>g(e).then(()=>e))})();return{refresh:y,login:async function(t,n={}){var a;await u(),"otp"in n&&(t.otp=n.otp),t.mode=n.mode??e;let l=(a=n.provider)?`/auth/login/${a}`:"/auth/login",c=i(s.url,l),f={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};"credentials"in r&&(f.credentials=r.credentials);let h=await o(c.toString(),f,s.globals.fetch);return await g(h),h},async logout(t={}){let n=await h.get(),a={method:"POST",headers:{"Content-Type":"application/json"}};"credentials"in r&&(a.credentials=r.credentials);let l={mode:t.mode??e};"json"===e&&n?.refresh_token&&(l.refresh_token=n.refresh_token),a.body=JSON.stringify(l);let c=i(s.url,"/auth/logout");await o(c.toString(),a,s.globals.fetch),this.stopRefreshing(),await u()},stopRefreshing(){f&&clearTimeout(f)},getToken:async()=>(await p().catch(()=>{}),(await h.get())?.access_token??null),setToken:async e=>h.set({access_token:e,refresh_token:null,expires:null,expires_at:null})}},h=e=>t=>{let s=e??null;return{getToken:async()=>s,async setToken(e){s=e}}},u={fetch:globalThis.fetch,WebSocket:globalThis.WebSocket,URL:globalThis.URL,logger:globalThis.console},d=(e,t={})=>{let s=t.globals?{...u,...t.globals}:u;return{globals:s,url:new s.URL(e),with(e){return{...this,...e(this)}}}},p=e=>{let t=(e,s=[])=>{if("object"==typeof e){let r=[];for(let i in e){let n=e[i]??[];if(Array.isArray(n))for(let e of n)r.push(t(e,[...s,i]));else if("object"==typeof n)for(let e of Object.keys(n))for(let o of n[e])r.push(t(o,[...s,`${i}:${e}`]))}return r.flatMap(e=>e)}return[...s,String(e)].join(".")};return e.flatMap(e=>t(e))},g=e=>{let t={};for(let[s,r]of(Array.isArray(e.fields)&&e.fields.length>0&&(t.fields=p(e.fields).join(",")),e.filter&&Object.keys(e.filter).length>0&&(t.filter=JSON.stringify(e.filter)),e.search&&(t.search=e.search),"sort"in e&&e.sort&&(t.sort="string"==typeof e.sort?e.sort:e.sort.join(",")),"number"==typeof e.limit&&e.limit>=-1&&(t.limit=String(e.limit)),"number"==typeof e.offset&&e.offset>=0&&(t.offset=String(e.offset)),"number"==typeof e.page&&e.page>=1&&(t.page=String(e.page)),e.deep&&Object.keys(e.deep).length>0&&(t.deep=JSON.stringify(e.deep)),e.alias&&Object.keys(e.alias).length>0&&(t.alias=JSON.stringify(e.alias)),e.aggregate&&Object.keys(e.aggregate).length>0&&(t.aggregate=JSON.stringify(e.aggregate)),e.groupBy&&e.groupBy.length>0&&(t.groupBy=e.groupBy.join(",")),Object.entries(e)))s in t||("string"==typeof r||"number"==typeof r||"boolean"==typeof r?t[s]=String(r):t[s]=JSON.stringify(r));return t},y=(e,t)=>{if(0===e.length)throw Error(t)},m=(e,t)=>{if(["directus_access","directus_activity","directus_collections","directus_comments","directus_fields","directus_files","directus_folders","directus_migrations","directus_permissions","directus_policies","directus_presets","directus_relations","directus_revisions","directus_roles","directus_sessions","directus_settings","directus_users","directus_webhooks","directus_dashboards","directus_panels","directus_notifications","directus_shares","directus_flows","directus_operations","directus_translations","directus_versions","directus_extensions"].includes(String(e)))throw Error(t)},b=(e,t)=>()=>(y(String(e),"Collection cannot be empty"),m(e,"Cannot use readItems for core collections"),{path:`/items/${e}`,params:t??{},method:"GET"}),_={},j=(e={})=>t=>{let s={..._,...e};return{async request(r){let n=r();if(n.headers||(n.headers={}),"Content-Type"in n.headers?"multipart/form-data"===n.headers["Content-Type"]&&delete n.headers["Content-Type"]:n.headers["Content-Type"]="application/json","getToken"in this&&!("Authorization"in n.headers)){let e=await this.getToken();e&&(n.headers.Authorization=`Bearer ${e}`)}let a=i(t.url,n.path,n.params),l={method:n.method??"GET",headers:n.headers??{}};"credentials"in s&&(l.credentials=s.credentials),n.body&&(l.body=n.body),n.onRequest&&(l=await n.onRequest(l)),s.onRequest&&(l=await s.onRequest(l));let c=await o(a.toString(),l,t.globals.fetch);return"onResponse"in n&&(c=await n.onResponse(c,l)),"onResponse"in e&&(c=await e.onResponse(c,l)),c}}}}};